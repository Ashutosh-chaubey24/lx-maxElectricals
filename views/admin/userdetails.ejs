<% layout('./boilerplate/boilerplate.ejs') %>
 <style>
    /* namespaced variables (safe) */
    :root{
      --pv-bg:#f6f8fb;
      --pv-card:#ffffff;
      --pv-muted:#68707a;
      --pv-primary:#2563eb;
      --pv-radius:12px;
      --pv-gap:16px;
      --pv-shadow:0 8px 24px rgba(11,22,40,0.06);
    }

    /* reset */
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial; background:var(--pv-bg); color:#0b1220}

    /* wrapper */
    .pv-wrap{
      max-width:1100px;
      margin:18px auto;
      padding:12px;
      display:flex;
      flex-direction:column; /* mobile first */
      gap:var(--pv-gap);
    }

    .pv-card{
      background:var(--pv-card);
      border-radius:var(--pv-radius);
      padding:14px;
      box-shadow:var(--pv-shadow);
    }

    /* USER (left) */
    .pv-left{
      width:100%;
    }
    .pv-user{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .pv-avatar{
      width:60px;height:60px;border-radius:10px;background:#eef5ff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:22px;color:var(--pv-primary);flex-shrink:0;
    }
    .pv-user-info{flex:1}
    .pv-name{font-weight:700;font-size:16px}
    .pv-meta{color:var(--pv-muted);font-size:13px;margin-top:4px}

    .pv-fields{margin-top:12px;display:flex;flex-direction:column;gap:10px}
    .pv-field{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-radius:8px;background:#fbfdff}
    .pv-label{color:var(--pv-muted);font-size:13px}
    .pv-value{font-weight:700}

    .pv-require{margin-top:12px;padding:10px;border-radius:8px;background:#fbfdff;font-weight:600;color:#0b1220}

    .pv-actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .pv-btn{padding:10px 12px;border-radius:10px;border:0;font-weight:700;cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; justify-content:center}
    .pv-btn-ghost{background:transparent;border:1px solid #e6e9ef;color:var(--pv-primary);flex:1}
    .pv-btn-primary{background:var(--pv-primary);color:#fff;flex:1}

    /* PRODUCT (right) */
    .pv-right{width:100%}
    .pv-product-top{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .pv-prod-body{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .pv-prod-media{width:100%;height:180px;border-radius:10px;background:#f1f7ff;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .pv-prod-media img{width:100%;height:100%;object-fit:contain;display:block}
    .pv-prod-title{font-weight:800;font-size:16px}
    .pv-prod-desc{color:var(--pv-muted);margin-top:6px}
    .pv-pills{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .pv-pill{background:#eef6ff;padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px}

    .pv-prod-ctas{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .pv-prod-ctas .pv-btn{flex:1}

    /* DESKTOP: two-column */
    @media (min-width:880px){
      .pv-wrap{flex-direction:row; align-items:flex-start}
      .pv-left{width:36%; min-width:260px}
      .pv-right{width:64%}
      .pv-user{align-items:flex-start}
      .pv-avatar{width:76px;height:76px;font-size:26px}
      .pv-prod-body{display:grid; grid-template-columns:220px 1fr; gap:16px; align-items:start}
      .pv-prod-media{height:220px}
      .pv-actions .pv-btn, .pv-prod-ctas .pv-btn{flex:0 0 auto}
    }

    /* very small phones */
    @media (max-width:420px){
      .pv-avatar{width:56px;height:56px;font-size:18px}
      .pv-prod-media{height:140px}
      .pv-name{font-size:15px}
    }
  </style>
</head>
<body>

  <div class="pv-wrap">
    <!-- LEFT / USER -->
    <div class="pv-left pv-card">
      <div class="pv-user">
        <div class="pv-avatar"><%= user && user.name ? user.name[0].toUpperCase() : 'U' %></div>
        <div class="pv-user-info">
          <div class="pv-name"><%= user && user.name ? user.name : 'Unknown' %></div>
          <div class="pv-meta"><%= user && user.type ? user.type : 'enquiry' %> • <%= user && user.source ? user.source : 'Website' %></div>
        </div>
      </div>

      <div class="pv-fields">
        <div class="pv-field"><div class="pv-label">Email</div><div class="pv-value"><%= user && user.email ? user.email : '-' %></div></div>
        <div class="pv-field"><div class="pv-label">Phone</div><div class="pv-value"><%= user && user.mobile ? user.mobile : '-' %></div></div>
        <% if(user && user.Quantity) { %>
          <div class="pv-field"><div class="pv-label">Quantity</div><div class="pv-value"><%= user.Quantity %></div></div>
        <% } %>
        <div class="pv-field"><div class="pv-label">Submitted</div><div class="pv-value"><%= user && user.createdAt ? (new Date(user.createdAt)).toDateString() : '-' %></div></div>
      </div>

      <% if(user && user.requirementDeatail) { %>
        <div class="pv-require"><%= user.requirementDeatail %></div>
      <% } %>

      <div class="pv-actions">
        <a class="pv-btn pv-btn-ghost" href="mailto:<%= user && user.email ? user.email : '' %>">Message</a>
        <a class="pv-btn pv-btn-ghost" href="tel:<%= user && user.mobile ? user.mobile : '' %>">Call</a>
        <a class="pv-btn pv-btn-primary" href="/admin/quotes/create?user=<%= user && user._id ? user._id : '' %>">Create Quote</a>
      </div>
    </div>

    <!-- RIGHT / PRODUCT -->
    <div class="pv-right pv-card">
      <div class="pv-product-top">
        <div class="pv-prod-title">Product selected by this user</div>
        <div style="display:flex;gap:8px;align-items:center">
          <form method="post" action="/admin/users/<%= user && user._id ? user._id : '' %>/clear-product" style="margin:0">
            <button type="submit" class="pv-btn pv-btn-ghost">Clear</button>
          </form>
        </div>
      </div>

      <div class="pv-prod-body">
          <% if(product) { %>
        <div class="pv-prod-media">
          <img src="<%= product.image %>" alt="product">
        </div>
        <%}%>

        <div>
          <% if(product) { %>
            <div class="pv-prod-title"><%= product.title || 'Untitled Product' %></div>
            <div class="pv-prod-desc"><%= product.description || 'No description available.' %></div>

            <div class="pv-pills">
              <div class="pv-pill">Price: <%= product.price ? '₹'+product.price : 'N/A' %></div>
              <div class="pv-pill">Location: <%= product.location || '—' %></div>
              <div class="pv-pill">MOQ: <%= product.moq || '—' %></div>
            </div>

            <div class="pv-prod-ctas">
              <a class="pv-btn pv-btn-ghost" href="/products/<%= product._id %>/download-spec">Download Spec</a>
              <a class="pv-btn pv-btn-primary" href="/admin/quotes/create?user=<%= user && user._id ? user._id : '' %>&product=<%= product._id %>">Request Pricing</a>
            </div>
          <% } else { %>
            <div style="font-weight:700;color:var(--pv-muted)">No product selected by this user.</div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

</body>


